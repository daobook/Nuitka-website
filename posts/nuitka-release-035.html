<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
    <link rel="icon" href="../_static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../_static/favicon.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../_static/favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="icon" href="../_static/apple-touch-icon-iphone.png" sizes="57x57" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad.png" sizes="72x72" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-iphone4.png" sizes="114x114" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad3.png" sizes="144x144" type="image/png">
    <link rel="apple-touch-icon" href="../_static/apple-touch-icon-180x180.png" sizes="180x180" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuitka Release 0.3.5</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-player_2.6.1.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" type="text/css" />
    <link rel="canonical" href="https://nuitka.net/posts/nuitka-release-035.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/tabs.js"></script>
        <script src="../_static/asciinema-player_2.6.1.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Nuitka Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nuitka the Python Compiler
            <img src="../_static/Nuitka-Logo-Symbol.png" class="logo" alt="Logo"/>
          </a><!-- Empty override file take the place of searchbox.html, which generates search box. -->
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commercial Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/commercial.html">Nuitka Commercial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html">Nuitka Release 0.6.19 (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-18">Nuitka Release 0.6.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-17">Nuitka Release 0.6.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#older-releases">Older Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/roadmap.html">Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/api-doc.html">API doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/factory.html">Factory Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/Presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/Streaming.html">Streaming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/impressum.html">Impressum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Under construction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/pyside2.html">Nuitka PySide2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/donations.html">Donations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/gsoc2019.html">Google Summer of Code 2019</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/nuitka-demo.html">Nuitka Demo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nuitka the Python Compiler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="nuitka-release-0-3-5">
<h1>Nuitka Release 0.3.5<a class="headerlink" href="#nuitka-release-0-3-5" title="Permalink to this headline"></a></h1>
<p>This is to inform you about the new stable release of <a class="reference external" href="https://nuitka.net">Nuitka</a>. It is the extremely compatible Python compiler,
<a class="reference external" href="/doc/download.html">“download now”</a>.</p>
<p>This new release of Nuitka is an overall improvement on many fronts,
there is no real focus this time, likely due to the long time it was in
the making.</p>
<p>The major points are more optimization work, largely enhanced import
handling and another improvement on the performance side. But there are
also many bug fixes, more test coverage, usability and compatibility.</p>
<p>Something esp. noteworthy to me and valued is that many important
changes were performed or at least triggered by Nicolas Dumazet, who
contributed a lot of high quality commits as you can see from the gitweb
history. He appears to try and compile Mercurial and Nuitka, and this
resulted in important contributions.</p>
<section id="bug-fixes">
<h2>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Nicolas found a reference counting bug with nested parameter calls.
Where a function had parameters of the form <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">(b,c)</span></code> it could
crash. This got fixed and covered with a reference count test.</p></li>
<li><p>Another reference count problem when accessing the locals dictionary
was corrected.</p></li>
<li><p>Values <code class="docutils literal notranslate"><span class="pre">0.0</span></code> and <code class="docutils literal notranslate"><span class="pre">-0.0</span></code> were treated as the same. They are not
though, they have a different sign that should not get lost.</p></li>
<li><p>Nested contractions didn’t work correctly, when the contraction was
to iterate over another contraction which needs a closure. The
problem was addressing by splitting the building of a contraction
from the body of the contraction, so that these are now 2 nodes,
making it easy for the closure handling to get things right.</p></li>
<li><p>Global statements in function with local <code class="docutils literal notranslate"><span class="pre">exec()</span></code> would still use
the value from the locals dictionary. Nuitka is now compatible to
CPython with this too.</p></li>
<li><p>Nicolas fixed problems with modules of the same name inside different
packages. We now use the full name including parent package names for
code generation and look-ups.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">__module__</span></code> attribute of classes was only set after the class
was created. Now it is already available in the class body.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">__doc__</span></code> attribute of classes was not set at all. Now it is.</p></li>
<li><p>The relative import inside nested packages now works correctly. With
Nicolas moving all of Nuitka to a package, the compile itself exposed
many weaknesses.</p></li>
<li><p>A local re-raise of an exception didn’t have the original line
attached but the re-raise statement line.</p></li>
</ul>
</section>
<section id="new-features">
<h2>New Features<a class="headerlink" href="#new-features" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Modules and packages have been unified. Packages can now also have
code in “__init__.py” and then it will be executed when the package
is imported.</p></li>
<li><p>Nicolas added the ability to create deep output directory structures
without having to create them beforehand. This makes
<code class="docutils literal notranslate"><span class="pre">--output-dir=some/deep/path</span></code> usable.</p></li>
<li><p>Parallel build by Scons was added as an option and enabled by
default, which enhances scalability for <code class="docutils literal notranslate"><span class="pre">--deep</span></code> compilations a
lot.</p></li>
<li><p>Nicolas enhanced the CPU count detection used for the parallel build.
Turned out that <code class="docutils literal notranslate"><span class="pre">multithreading.cpu_count()</span></code> doesn’t give us the
number of available cores, so he contributed code to determine that.</p></li>
<li><p>Support for upcoming g++ 4.6 has been added. The use of the new
option <code class="docutils literal notranslate"><span class="pre">--lto</span></code> has been been prepared, but right now it appears
that the C++ compiler will need more fixes, before we can this
feature with Nuitka.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--display-tree</span></code> feature got an overhaul and now displays the
node tree along with the source code. It puts the cursor on the line
of the node you selected. Unfortunately I cannot get it to work
two-way yet. I will ask for help with this in a separate posting as
we can really use a “python-qt” expert it seems.</p></li>
<li><p>Added meaningful error messages in the “file not found” case.
Previously I just didn’t care, but we sort of approach end user
usability with this.</p></li>
</ul>
</section>
<section id="optimization">
<h2>Optimization<a class="headerlink" href="#optimization" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Added optimization for the built-in <code class="docutils literal notranslate"><span class="pre">range()</span></code> which otherwise
requires a module and <code class="docutils literal notranslate"><span class="pre">builtin</span></code> module lookup, then parameter
parsing. Now this is much faster with Nuitka and small ranges (less
than 256 values) are converted to constants directly, avoiding run
time overhead entirely.</p></li>
<li><p>Code for re-raise statements now use a simple re-throw of the
exception where possible, and only do the hard work where the
re-throw is not inside an exception handler.</p></li>
<li><p>Constant folding of operations and comparisons is now performed if
the operands are constants.</p></li>
<li><p>Values of some built-ins are pre-computed if the operands are
constants.</p></li>
<li><p>The value of module attribute <code class="docutils literal notranslate"><span class="pre">__name__</span></code> is replaced by a constant
unless it is assigned to. This is the first sign of upcoming constant
propagation, even if only a weak one.</p></li>
<li><p>Conditional statement and/or their branches are eliminated where
constant conditions allow it.</p></li>
</ul>
</section>
<section id="cleanups">
<h2>Cleanups<a class="headerlink" href="#cleanups" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Nicolas moved the Nuitka source code to its own <code class="docutils literal notranslate"><span class="pre">nuitka</span></code> package.
That is going to make packaging it a lot easier and allows cleaner
code.</p></li>
<li><p>Nicolas introduced a fast path in the tree building which often
delegates (or should do that) to a function. This reduced a lot of
the dispatching code and highlights more clearly where such is
missing right now.</p></li>
<li><p>Together we worked on the line length issues of Nuitka. We agreed on
a style and very long lines will vanish from Nuitka with time. Thanks
for pushing me there.</p></li>
<li><p>Nicolas also did provide many style fixes and general improvements,
e.g. using <code class="docutils literal notranslate"><span class="pre">PyObjectTemporary</span></code> in more places in the C++ code, or
not using <code class="docutils literal notranslate"><span class="pre">str.find</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">in</span> <span class="pre">y</span></code> is a better choice.</p></li>
<li><p>The node structure got cleaned up towards the direction that
assignments always have an assignment as a child.</p>
<p>A function definition, or a class definition, are effectively
assignments, and in order to not have to treat this as special cases
everywhere, they need to have assignment targets as child nodes.</p>
<p>Without such changes, optimization will have to take too many things
into account. This is not yet completed.</p>
</li>
<li><p>Nicolas merged some node tree building functions that previously
handled deletion and assigning differently, giving us better code
reuse.</p></li>
<li><p>The constants code generation was moved to a <code class="docutils literal notranslate"><span class="pre">__constants.cpp</span></code>
where it doesn’t make __main__.cpp so much harder to read anymore.</p></li>
<li><p>The module declarations have been moved to their own header files.</p></li>
<li><p>Nicolas cleaned up the scripts used to test Nuitka big time, removing
repetitive code and improving the logic. Very much appreciated.</p></li>
<li><p>Nicolas also documented a things in the Nuitka source code or got me
to document things that looked strange, but have reasons behind it.</p></li>
<li><p>Nicolas solved the <code class="docutils literal notranslate"><span class="pre">TODO</span></code> related to built-in module accesses.
These will now be way faster than before.</p></li>
<li><p>Nicolas also solved the <code class="docutils literal notranslate"><span class="pre">TODO</span></code> related to the performance of
“locals dict” variable accesses.</p></li>
<li><p>Generator.py no longer contains classes. The Contexts objects are
supposed to contain the state, and as such the generator objects
never made much sense.</p></li>
<li><p>Also with the help of Scons community, I figured out how to avoid
having object files inside the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory of Nuitka. That
should also help packaging, now all build products go to the .build
directory as they should.</p></li>
<li><p>The vertical white space of the generated C++ got a few cleanups,
trailing/leading new line is more consistent now, and there were some
assertions added that it doesn’t happen.</p></li>
</ul>
</section>
<section id="new-tests">
<h2>New Tests<a class="headerlink" href="#new-tests" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>The CPython 2.6 tests are now also run by CPython 2.7 and the other
way around and need to report the same test failure reports, which
found a couple of issues.</p></li>
<li><p>Now the test suite is run with and without <code class="docutils literal notranslate"><span class="pre">--debug</span></code> mode.</p></li>
<li><p>Basic tests got extended to cover more topics and catch more issues.</p></li>
<li><p>Program tests got extended to cover code in packages.</p></li>
<li><p>Added more exec scope tests. Currently inlining of exec statements is
disabled though, because it requires entirely different rules to be
done right, it has been pushed back to the next release.</p></li>
</ul>
</section>
<section id="organisational">
<h2>Organisational<a class="headerlink" href="#organisational" title="Permalink to this headline"></a></h2>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">g++-nuitka</span></code> script is no more. With the help of the Scons
community, this is now performed inside the scons and only once
instead of each time for every C++ file.</p></li>
<li><p>When using <code class="docutils literal notranslate"><span class="pre">--debug</span></code>, the generated C++ is compiled with <code class="docutils literal notranslate"><span class="pre">-Wall</span></code>
and <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> so that some form of bugs in the generated C++ code
will be detected immediately. This found a few issues already.</p></li>
<li><p>There is a new git merge policy in place. Basically it says, that if
you submit me a pull request, that I will deal with it before
publishing anything new, so you can rely on the current git to
provide you a good base to work on. I am doing more frequent
pre-releases already and I would like to merge from your git.</p></li>
<li><p>The “README.txt” was updated to reflect current optimization status
and plans. There is still a lot to do before constant propagation can
work, but this explains things a bit better now. I hope to expand
this more and more with time.</p></li>
<li><p>There is now a “misc/clean-up.sh” script that prints the commands to
erase all the temporary files sticking around in the source tree.</p>
<p>That is for you if you like me, have other directories inside,
ignored, that you don’t want to delete.</p>
</li>
<li><p>Then there is now a script that prints all source filenames, so you
can more easily open them all in your editor.</p></li>
<li><p>And very important, there is now a “check-release.sh” script that
performs all the tests I think should be done before making a
release.</p></li>
<li><p>Pylint got more happy with the current Nuitka source. In some places,
I added comments where rules should be granted exceptions.</p></li>
</ul>
</section>
<section id="numbers">
<h2>Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline"></a></h2>
<p>python 2.6:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pystone</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span> <span class="n">time</span> <span class="k">for</span> <span class="mi">50000</span> <span class="n">passes</span> <span class="o">=</span> <span class="mf">0.65</span>
<span class="n">This</span> <span class="n">machine</span> <span class="n">benchmarks</span> <span class="n">at</span> <span class="mf">76923.1</span> <span class="n">pystones</span><span class="o">/</span><span class="n">second</span>
</pre></div>
</div>
<p>Nuitka 0.3.5 (driven by python 2.6):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pystone</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span> <span class="n">time</span> <span class="k">for</span> <span class="mi">50000</span> <span class="n">passes</span> <span class="o">=</span> <span class="mf">0.31</span>
<span class="n">This</span> <span class="n">machine</span> <span class="n">benchmarks</span> <span class="n">at</span> <span class="mi">161290</span> <span class="n">pystones</span><span class="o">/</span><span class="n">second</span>
</pre></div>
</div>
<p>This is 109% for 0.3.5, up from 91% before.</p>
<p>Overall this release is primarily an improvement in the domain of
compatibility and contains important bug and feature fixes to the users.
The optimization framework only makes a first showing of with the
framework to organize them. There is still work to do to migrate
optimization previously present</p>
<p>It will take more time before we will see effect from these. I believe
that even more cleanups of <code class="docutils literal notranslate"><span class="pre">TreeBuilding</span></code>, <code class="docutils literal notranslate"><span class="pre">Nodes</span></code> and
<code class="docutils literal notranslate"><span class="pre">CodeGeneration</span></code> will be required, before everything is in place for
the big jump in performance numbers. But still, passing 100% feels good.
Time to rejoice.</p>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="python-float-quiz.html">
       Quiz Question
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="nuitka-release-036.html">
      Nuitka Release 0.3.6 
    </a>
    
  </span>
</div>
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Kay Hayen and Nuitka Contributors.</p>
  </div>

  
<div class='share-button-container'>
    <div class="socialbutton-wrapper">
        <a href="https://twitter.com/share?url=https://nuitka.net/posts/nuitka-release-035.html&hashtags=nuitka" target="_blank">
            <div class="socialbutton twitter" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-twitter.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="https://www.facebook.com/sharer.php?u=https://nuitka.net/posts/nuitka-release-035.html&hashtag=%23nuitka"  target="_blank">
            <div class="socialbutton facebook" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-facebook.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="http://www.reddit.com/submit?url=https://nuitka.net/posts/nuitka-release-035.html" target="_blank">
            <div class="socialbutton reddit">
                <p class="icon">
                    <img src="/_static/icon-reddit.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
      $('a[href^="http://"], a[href^="https://"]').not('a[class*=internal]').attr('target', '_blank');
    });
  </script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V73VK1T804"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-V73VK1T804', {
          'anonymize_ip': true,
      });
    </script> 

</body>
</html>