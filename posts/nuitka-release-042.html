<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
    <link rel="icon" href="../_static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../_static/favicon.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../_static/favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="icon" href="../_static/apple-touch-icon-iphone.png" sizes="57x57" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad.png" sizes="72x72" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-iphone4.png" sizes="114x114" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad3.png" sizes="144x144" type="image/png">
    <link rel="apple-touch-icon" href="../_static/apple-touch-icon-180x180.png" sizes="180x180" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuitka Release 0.4.2</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-player_2.6.1.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" type="text/css" />
    <link rel="canonical" href="https://nuitka.net/posts/nuitka-release-042.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/tabs.js"></script>
        <script src="../_static/asciinema-player_2.6.1.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Nuitka Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nuitka the Python Compiler
            <img src="../_static/Nuitka-Logo-Symbol.png" class="logo" alt="Logo"/>
          </a><!-- Empty override file take the place of searchbox.html, which generates search box. -->
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commercial Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/commercial.html">Nuitka Commercial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html">Nuitka Release 0.6.19 (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-18">Nuitka Release 0.6.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-17">Nuitka Release 0.6.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#older-releases">Older Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/roadmap.html">Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/api-doc.html">API doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/factory.html">Factory Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/Presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/Streaming.html">Streaming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/impressum.html">Impressum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Under construction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/pyside2.html">Nuitka PySide2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/donations.html">Donations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/gsoc2019.html">Google Summer of Code 2019</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/nuitka-demo.html">Nuitka Demo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nuitka the Python Compiler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="nuitka-release-0-4-2">
<h1>Nuitka Release 0.4.2<a class="headerlink" href="#nuitka-release-0-4-2" title="Permalink to this headline"></a></h1>
<p>This is to inform you about the new stable release of <a class="reference external" href="https://nuitka.net">Nuitka</a>. It is the extremely compatible Python compiler,
<a class="reference external" href="/doc/download.html">“download now”</a>.</p>
<p>This release comes with many bug fixes, some of which are severe. It
also contains new features, like basic Python 3.3 support. And the
<a class="reference external" href="https://nuitka.net/pages/performance.html">performance diagrams</a> got
expanded.</p>
<section id="new-features">
<h2>New Features<a class="headerlink" href="#new-features" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Support for FreeBSD.</p>
<p>Nuitka works for at least FreeBSD 9.1, older versions may or may not
work. This required only fixing some “Linuxisms” in the build
process.</p>
</li>
<li><p>New option for warning about compile time detected exception raises.</p>
<p>Nuitka can now warn about exceptions that will be raised at run time.</p>
</li>
<li><p>Basic Python3.3 support.</p>
<p>The test suite of CPython3.2 passes and fails in a compatible way.
New feature <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> is not yet supported, and the improved
argument parsing error messages are not implemented yet.</p>
</li>
</ul>
</section>
<section id="bug-fixes">
<h2>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Nuitka already supported compilation of “main directories”, i.e.
directories with a “__main__.py” file inside. The resulting binary
name was “__main__.exe” though, but now it is “directory.exe”</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls directory</span>
__main__.py

<span class="c1"># nuitka --exe directory</span>
<span class="c1"># ls</span>
directory directory.exe
</pre></div>
</div>
<p>This makes this usage more obvious, and fixes an older issue for this
feature.</p>
</li>
<li><p>Evaluation order of binary operators was not enforced.</p>
<p>Nuitka already enforces evaluation order for just about everything.
But not for binary operators it seems.</p>
</li>
<li><p>Providing an <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">coding:</span> <span class="pre">no-exist</span></code> was crashing under Python2, and
ignored under Python3, now it does the compatible thing for both.</p></li>
<li><p>Global statements on the compiler level are legal in Python, and were
not handled by Nuitka, they now are.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">global</span> <span class="n">a</span>  <span class="c1"># Not in a function, but on module level. Pointless but legal!</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Effectively these statements can be ignored.</p>
</li>
<li><p>Future imports are only legal when they are at the start of the file.</p>
<p>This was not enforced by Nuitka, making it accept code, which CPython
would reject. It now properly raises a syntax error.</p>
</li>
<li><p>Raising exceptions from context was leaking references.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span> <span class="kn">from</span> <span class="bp">None</span>
</pre></div>
</div>
<p>Under CPython3.2 the above is not allowed (it is acceptable starting
CPython3.3), and was also leaking references to its arguments.</p>
</li>
<li><p>Importing the module that became <code class="docutils literal notranslate"><span class="pre">__main__</span></code> through the module
name, didn’t recurse to it.</p>
<p>This also gives a warning. PyBench does it, and then stumbles over
the non-found “pybench” module. Of course, programmers should use
<code class="docutils literal notranslate"><span class="pre">sys.modules[</span> <span class="pre">&quot;__main__&quot;</span> <span class="pre">]</span></code> to access main module code. Not only
because the duplicated modules don’t share data.</p>
</li>
<li><p>Compiled method <code class="docutils literal notranslate"><span class="pre">repr</span></code> leaked references when printed.</p>
<p>When printing them, they would not be freed, and subsequently hold
references to the object (and class) they belong to. This could
trigger bugs for code that expects <code class="docutils literal notranslate"><span class="pre">__del__</span></code> to run at some point.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">super</span></code> built-in leaked references to given object.</p>
<p>This was added, because Python3 needs it. It supplies the arguments
to <code class="docutils literal notranslate"><span class="pre">super</span></code> automatically, whereas for Python2 the programmer had to
do it. And now it turns out that the object lost a reference, causing
similar issues as above, preventing <code class="docutils literal notranslate"><span class="pre">__del__</span></code> to run.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">raise</span></code> statement didn’t enforce type of third argument.</p>
<p>This Python2-only form of exception raising now checks the type of
the third argument before using it. Plus, when it’s None (which is
also legal), no reference to None is leaked.</p>
</li>
<li><p>Python3 built-in exceptions were strings instead of exceptions.</p>
<p>A gross mistake that went uncaught by test suites. I wonder how. Them
being strings doesn’t help their usage of course, fixed.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-nan</span></code> and <code class="docutils literal notranslate"><span class="pre">nan</span></code> both exist and make a difference.</p>
<p>A older story continued. There is a sign to <code class="docutils literal notranslate"><span class="pre">nan</span></code>, which can be
copied away and should be present. This is now also supported by
Nuitka.</p>
</li>
<li><p>Wrong optimization of <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">!=</span> <span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;=</span> <span class="pre">a</span></code> on C++
level.</p>
<p>While it’s not done during Nuitka optimization, the rich comparison
helpers still contained short cuts for <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">sys.executable</span></code> for <code class="docutils literal notranslate"><span class="pre">nuitka-python</span> <span class="pre">--python-version</span> <span class="pre">3.2</span></code> was
still <code class="docutils literal notranslate"><span class="pre">python</span></code>.</p>
<p>When determining the value for <code class="docutils literal notranslate"><span class="pre">sys.executable</span></code> the CPython library
code looks at the name <code class="docutils literal notranslate"><span class="pre">exec</span></code> had received. It was <code class="docutils literal notranslate"><span class="pre">python</span></code> in
all cases, but now it depends on the running version, so it
propagates.</p>
</li>
<li><p>Keyword only functions with default values were losing references to
defaults.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">X</span><span class="p">()):</span>
    <span class="k">pass</span>


<span class="n">f</span><span class="p">()</span>
<span class="n">f</span><span class="p">()</span>  <span class="c1"># Can crash, X() should already be released.</span>
</pre></div>
</div>
<p>This is now corrected. Of course, a Python3 only issue.</p>
</li>
<li><p>Pressing CTRL-C didn’t generate <code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code> in compiled
code.</p>
<p>Nuitka never executes “pending calls”. It now does, with the upside,
that the solution used, appears to be suitable for threading in
Nuitka too. Expect more to come out of this.</p>
</li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">with</span></code> statements with <code class="docutils literal notranslate"><span class="pre">return</span></code>, <code class="docutils literal notranslate"><span class="pre">break</span></code>, or <code class="docutils literal notranslate"><span class="pre">continue</span></code>
to leave their body, the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> was not called.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">a</span><span class="p">:</span>  <span class="c1"># This called a.__enter__().</span>
    <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># This didn&#39;t call a.__exit__(None, None, None).</span>
</pre></div>
</div>
<p>This is of course quite huge, and unfortunately wasn’t covered by any
test suite so far. Turns out, the re-formulation of <code class="docutils literal notranslate"><span class="pre">with</span></code>
statements, was wrongly using <code class="docutils literal notranslate"><span class="pre">try/except/else</span></code>, but these ignore
the problematic statements. Only <code class="docutils literal notranslate"><span class="pre">try/finally</span></code> does. The enhanced
re-formulation now does the correct thing.</p>
</li>
<li><p>Starting with Python3, absolute imports are now the default.</p>
<p>This was already present for Python3.3, and it turns out that all of
Python3 does it.</p>
</li>
</ul>
</section>
<section id="optimization">
<h2>Optimization<a class="headerlink" href="#optimization" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Constants are now much less often created with <code class="docutils literal notranslate"><span class="pre">pickle</span></code> module, but
created directly.</p>
<p>This esp. applies for nested constants, now more values become <code class="docutils literal notranslate"><span class="pre">is</span></code>
identical instead of only <code class="docutils literal notranslate"><span class="pre">==</span></code> identical, which indicates a reduced
memory usage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;something_special&quot;</span><span class="p">,)</span>
<span class="n">b</span> <span class="o">=</span> <span class="s2">&quot;something_special&quot;</span>

<span class="k">assert</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">b</span>  <span class="c1"># Now true</span>
</pre></div>
</div>
<p>This is not only about memory efficiency, but also about performance.
Less memory usage is more cache friendly, and the “==” operator will
be able to shortcut dramatically in cases of identical objects.</p>
<p>Constants now created without <code class="docutils literal notranslate"><span class="pre">pickle</span></code> usage, cover <code class="docutils literal notranslate"><span class="pre">float</span></code>,
<code class="docutils literal notranslate"><span class="pre">list</span></code>, and <code class="docutils literal notranslate"><span class="pre">dict</span></code>, which is enough for PyStone to not use it at
all, which has been added support for as well.</p>
</li>
<li><p>Continue statements might be optimized away.</p>
<p>A terminal <code class="docutils literal notranslate"><span class="pre">continue</span></code> in a loop, was not optimized away:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">something</span>
    <span class="k">continue</span>  <span class="c1"># Now optimized away</span>
</pre></div>
</div>
<p>The trailing <code class="docutils literal notranslate"><span class="pre">continue</span></code> has no effect and can therefore be removed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">something</span>
</pre></div>
</div>
</li>
<li><p>Loops with only break statements are optimized away.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>
</div>
<p>A loop immediately broken has of course no effect. Loop conditions
are re-formulated to immediate “if … : break” checks. Effectively
this means that loops with conditions detected to be always false to
see the loop entirely removed.</p>
</li>
</ul>
</section>
<section id="new-tests">
<h2>New Tests<a class="headerlink" href="#new-tests" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Added tests for the found issues.</p></li>
<li><p>Running the programs test suite (i.e. recursion) for Python3.2 and
Python3.2 as well, after making adaptation so that the absolute
import changes are now covered.</p></li>
<li><p>Running the “CPython3.2” test suite with Python3.3 based Nuitka works
and found a few minor issues.</p></li>
</ul>
</section>
<section id="organisational">
<h2>Organisational<a class="headerlink" href="#organisational" title="Permalink to this headline"></a></h2>
<ul>
<li><p>The <a class="reference external" href="https://nuitka.net/doc/download.html">Downloads</a> page now
offers RPMs for RHEL6, CentOS6, F17, F18, and openSUSE 12.1, 12.2,
12.3. This large coverage is thanks to openSUSE build service and
“ownssh” for contributing an RPM spec file.</p>
<p>The page got improved with logos for the distributions.</p>
</li>
<li><p>Added “ownssh” as contributor.</p></li>
<li><p>Revamped the <a class="reference external" href="https://nuitka.net/doc/user-manual.html">User Manual</a> in terms of layout,
structure, and content.</p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline"></a></h2>
<p>This release is the result of much validation work. The amount of fixes
the largest of any release so far. New platforms, basic Python3.3
support, consolidation all around.</p>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="nuitka-rpms-rhel-centos-f17-f18-opensuse.html">
       Nuitka RPMs (RHEL, CentOS, F17, F18, openSUSE)
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="netbsd-support-upcoming.html">
      NetBSD support upcoming 
    </a>
    
  </span>
</div>
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Kay Hayen and Nuitka Contributors.</p>
  </div>

  
<div class='share-button-container'>
    <div class="socialbutton-wrapper">
        <a href="https://twitter.com/share?url=https://nuitka.net/posts/nuitka-release-042.html&hashtags=nuitka" target="_blank">
            <div class="socialbutton twitter" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-twitter.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="https://www.facebook.com/sharer.php?u=https://nuitka.net/posts/nuitka-release-042.html&hashtag=%23nuitka"  target="_blank">
            <div class="socialbutton facebook" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-facebook.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="http://www.reddit.com/submit?url=https://nuitka.net/posts/nuitka-release-042.html" target="_blank">
            <div class="socialbutton reddit">
                <p class="icon">
                    <img src="/_static/icon-reddit.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
      $('a[href^="http://"], a[href^="https://"]').not('a[class*=internal]').attr('target', '_blank');
    });
  </script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V73VK1T804"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-V73VK1T804', {
          'anonymize_ip': true,
      });
    </script> 

</body>
</html>