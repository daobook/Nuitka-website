<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
    <link rel="icon" href="../_static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../_static/favicon.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../_static/favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="icon" href="../_static/apple-touch-icon-iphone.png" sizes="57x57" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad.png" sizes="72x72" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-iphone4.png" sizes="114x114" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad3.png" sizes="144x144" type="image/png">
    <link rel="apple-touch-icon" href="../_static/apple-touch-icon-180x180.png" sizes="180x180" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuitka this week #10</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-player_2.6.1.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" type="text/css" />
    <link rel="canonical" href="https://nuitka.net/posts/nuitka-this-week-10.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/tabs.js"></script>
        <script src="../_static/asciinema-player_2.6.1.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Nuitka Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nuitka the Python Compiler
            <img src="../_static/Nuitka-Logo-Symbol.png" class="logo" alt="Logo"/>
          </a><!-- Empty override file take the place of searchbox.html, which generates search box. -->
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use.html">国际化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commercial Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/commercial.html">Nuitka Commercial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html">Nuitka Release 0.6.19 (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-18">Nuitka Release 0.6.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-17">Nuitka Release 0.6.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#older-releases">Older Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/roadmap.html">Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/api-doc.html">API doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/factory.html">Factory Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/Presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/Streaming.html">Streaming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/impressum.html">Impressum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Under construction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/pyside2.html">Nuitka PySide2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/donations.html">Donations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/gsoc2019.html">Google Summer of Code 2019</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/nuitka-demo.html">Nuitka Demo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nuitka the Python Compiler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="nuitka-this-week-10">
<h1><a class="toc-backref" href="#id2">Nuitka this week #10</a><a class="headerlink" href="#nuitka-this-week-10" title="Permalink to this headline"></a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#nuitka-this-week-10" id="id2">Nuitka this week #10</a></p>
<ul>
<li><p><a class="reference internal" href="#communication-vs-coding" id="id3">Communication vs. Coding</a></p></li>
<li><p><a class="reference internal" href="#hotfixes" id="id4">Hotfixes</a></p></li>
<li><p><a class="reference internal" href="#google-summer-of-code-for-nuitka" id="id5">Google Summer of Code for Nuitka</a></p></li>
<li><p><a class="reference internal" href="#pythran-and-nuitka" id="id6">Pythran and Nuitka</a></p></li>
<li><p><a class="reference internal" href="#performance-work" id="id7">Performance Work</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-specialized-object-operations" id="id8">Adding specialized object operations</a></p></li>
<li><p><a class="reference internal" href="#controlflow-descriptions" id="id9">Controlflow Descriptions</a></p></li>
<li><p><a class="reference internal" href="#preparations-for-comparison-operations" id="id10">Preparations for comparison operations</a></p></li>
<li><p><a class="reference internal" href="#comparison-conditions" id="id11">Comparison Conditions</a></p></li>
<li><p><a class="reference internal" href="#local-variable-escaping" id="id12">Local variable escaping</a></p></li>
<li><p><a class="reference internal" href="#benchmarks-missing" id="id13">Benchmarks Missing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#static-linking" id="id14">Static Linking</a></p></li>
<li><p><a class="reference internal" href="#conda-cc" id="id15">Conda CC</a></p></li>
<li><p><a class="reference internal" href="#annotations-future-feature" id="id16">Annotations Future Feature</a></p></li>
<li><p><a class="reference internal" href="#msi-files" id="id17">MSI files</a></p></li>
<li><p><a class="reference internal" href="#overall" id="id18">Overall</a></p></li>
<li><p><a class="reference internal" href="#twitter" id="id19">Twitter</a></p></li>
<li><p><a class="reference internal" href="#help-wanted" id="id20">Help Wanted</a></p></li>
<li><p><a class="reference internal" href="#donations" id="id21">Donations</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="communication-vs-coding">
<h2><a class="toc-backref" href="#id3">Communication vs. Coding</a><a class="headerlink" href="#communication-vs-coding" title="Permalink to this headline"></a></h2>
<p>Recently it was a bit more tough to make that decision. First, there was
much going privately, with me ill, then child ill, and ill again, and
myself, and that made me have a much harder time to communicate about
incomplete things.</p>
<p>Even now, I am torn between fixing issues for 0.6.1 and doing this, but
I know that it will take at least one week, so I am missing the point,
if I wait for it more.</p>
<p>Bear in mind, that this is supposed to be a quick, not too polished, and
straight from top of my head, even if really a lot of content. But I
feel that esp. the optimization parts are worth reading.</p>
</section>
<section id="hotfixes">
<h2><a class="toc-backref" href="#id4">Hotfixes</a><a class="headerlink" href="#hotfixes" title="Permalink to this headline"></a></h2>
<p>There has been another hotfix, 0.6.0.6 and there ought to be one
0.6.0.7, at least on factory there is a bunch of stuff for it, but I
didn’t actually do it yet. I was wandering between there will be a
release anyway, and the feeling that some of the material may cause
regressions, so I might skip on that really.</p>
<p>So for the most fixes, I suspect, develop is going to be the way until
next week.</p>
</section>
<section id="google-summer-of-code-for-nuitka">
<h2><a class="toc-backref" href="#id5">Google Summer of Code for Nuitka</a><a class="headerlink" href="#google-summer-of-code-for-nuitka" title="Permalink to this headline"></a></h2>
<p>Nobody has stepped up, which means it will not happen unfortunately.
This would be your last chance to step up. I know you will feel not
qualified. But I just need a backup that will help a student around
obstacles in case I go missing. Contact me and I will be very happy.</p>
</section>
<section id="pythran-and-nuitka">
<h2><a class="toc-backref" href="#id6">Pythran and Nuitka</a><a class="headerlink" href="#pythran-and-nuitka" title="Permalink to this headline"></a></h2>
<p>As suggested by &#64;wuoulf (Wolf Vollprecht) we had a meeting at the side
of the PyCon DE 2018 conference in Karlsruhe, abusing the C++ regular
table as a forum for that, which was a very nice experience.</p>
<p>First of all, Wolf is so much more knowledgeable about AnaConda and
could point out to me, very important stuff, not the least, that
AnaConda contains its own compiler, which I have successfully used
since, to first add easier installation instructions for Windows, and
second, to successfully statically link with LTO on Linux amd64. Both of
which are important for me.</p>
<p>But for Pythran which is limited Python, specialized to translate Numpy
API to C++, we showed each other, Nuitka and Pythran details, and
somehow in my mind a plan formed how Nuitka could use the Pythran tricks
long term, and mid term, how it could include a plugin that will allow
to integrate with Pythran compilation.</p>
<p>This was a huge success.</p>
</section>
<section id="performance-work">
<h2><a class="toc-backref" href="#id7">Performance Work</a><a class="headerlink" href="#performance-work" title="Permalink to this headline"></a></h2>
<section id="adding-specialized-object-operations">
<h3><a class="toc-backref" href="#id8">Adding specialized object operations</a><a class="headerlink" href="#adding-specialized-object-operations" title="Permalink to this headline"></a></h3>
<p>See last week, this has seen more completion. Both <cite>+</cite> and <cite>+=</cite> are more
or less covered for the selected subset. The CPython test suites were
initially not finding uses, but with more and more optimization phase
improvements, it challenges code generation with missing ones, and then
I added them more and more.</p>
</section>
<section id="controlflow-descriptions">
<h3><a class="toc-backref" href="#id9">Controlflow Descriptions</a><a class="headerlink" href="#controlflow-descriptions" title="Permalink to this headline"></a></h3>
<p>Shapes were added for the <cite>+</cite> and <cite>&lt;</cite> operation so far, but didn’t
influence anything else really but code generation, but of course they
should also impact optimization phase.</p>
<p>So the query for type shape has been enhanced to return not only a type
shape saying that <cite>int+float -&gt; float</cite>, but also now an object that
describes impact on control flow of the program. This can then say e.g.
that this doesn’t execute arbitrary code, and that it does not modify
input values, things used in the code generation to avoid error checks,
and in the optimization to not have to mark things as unknown.</p>
</section>
<section id="preparations-for-comparison-operations">
<h3><a class="toc-backref" href="#id10">Preparations for comparison operations</a><a class="headerlink" href="#preparations-for-comparison-operations" title="Permalink to this headline"></a></h3>
<p>So optimization now also has proper type shape functions for the <cite>&lt;</cite> and
the warnings when they fail to know what to do for concrete types. This
allows to actually remove checks, but so far this wasn’t exposed for
neither <cite>+</cite> or for <cite>&lt;</cite>. Doing this eliminates the exception check for
the operation part, where previously it was done if anything in the
expression could raise.</p>
<p>Specializing the rich comparisons helper codes is the next step, but so
far I didn’t quite get to it yet, but it has been started.</p>
</section>
<section id="comparison-conditions">
<h3><a class="toc-backref" href="#id11">Comparison Conditions</a><a class="headerlink" href="#comparison-conditions" title="Permalink to this headline"></a></h3>
<p>Preparing <cite>&lt;</cite> optimization for the loop, I noticed that <cite>not</cite> was
optimized for <cite>in</cite> to become <cite>not in</cite>, and also <cite>is</cite> to become <cite>is not</cite>,
etc. but for comparisons, where we can not the result is of bool shape,
we can now also switch <cite>not &lt;</cite> to <cite>&gt;=</cite> and <cite>not =</cite> to <cite>!=</cite> of course.</p>
<p>And since our reformulation of <cite>while a &lt; b</cite> ends up having a statement
like <cite>if not a &lt; b: break</cite> as part of its re-formulation, that is again
one step closer to optimizing my example loop.</p>
</section>
<section id="local-variable-escaping">
<h3><a class="toc-backref" href="#id12">Local variable escaping</a><a class="headerlink" href="#local-variable-escaping" title="Permalink to this headline"></a></h3>
<p>Much to my shock, I noticed that the code which is responsible to handle
escaping control flow (i.e. unknown code is executed), was not only
doing what it was supposed to do, i.e. mark closure variables as
unknown, but more or less did it for all local variables with Python3.</p>
<p>Fixing that allows for a lot more optimization obviously, and makes my
test find missing ones, and even bugs in existing ones, that were
previously hidden. A good thing to notice this regression (was better
once), now that I am looking at concrete examples.</p>
<p>One noticeable sign was that more of my tests failed with warnings about
missing code helpers. And another that in my while loop with <cite>int</cite>
increase, it now seems as if Python3 is good. For Python2, the “int or
long” shape will need dedicated helpers. That is because <cite>ìnt + int</cite>
becomes either <cite>int</cite> or <cite>long</cite> there, where Python3 only has <cite>long</cite> but
renamed it <cite>int</cite>.</p>
</section>
<section id="benchmarks-missing">
<h3><a class="toc-backref" href="#id13">Benchmarks Missing</a><a class="headerlink" href="#benchmarks-missing" title="Permalink to this headline"></a></h3>
<p>Speedcenter got repaired, but I need to add the loop examples I am using
as test cases before next release, so I can show what Nuitka 0.6.1 will
have achieved or at least have improved somewhat already.</p>
<p>But currently these examples only serve as input for general
improvements that then take a lot of time, and don’t have immediate
impact on their own.</p>
<p>Still would be good to see where Nuitka is standing after each one.</p>
</section>
</section>
<section id="static-linking">
<h2><a class="toc-backref" href="#id14">Static Linking</a><a class="headerlink" href="#static-linking" title="Permalink to this headline"></a></h2>
<p>So static linking works now, provided it’s not a <cite>pyenv</cite> crappy
<cite>libpython.a</cite> but one that can actually work. I got this to work on
Linux and using the Conda CC, even LTO will work with it. Interestingly
then linking is noticely slow, and I bet <cite>ccache</cite> and the likes won’t
help with that.</p>
<p>I am interested to see what this means for performance impact. But it
will allow to address issues, where embedded CPython run time is plain
slower than the one that lives in the python binary. For acceleration
this is great news.</p>
</section>
<section id="conda-cc">
<h2><a class="toc-backref" href="#id15">Conda CC</a><a class="headerlink" href="#conda-cc" title="Permalink to this headline"></a></h2>
<p>Using Conda CC by default as a fallback in <cite>–mingw</cite> mode on Windows is
something that was easy to add. So when no other <cite>gcc</cite> is found, and
MSVC is not tried in this mode, and the right directory is added to
<cite>PATH</cite> automatically, with Anaconda, things should now be smoother. It
has also its own <cite>libpython.a</cite>, not sure yet if it’s a static link
library, that would be fantastic, but unlike standard MinGW64 we do not
have to roll our own at least.</p>
<p>I will try with <cite>–lto</cite> eventually though and see what it does. But I
think static linking on Windows is not supported by CPython, but I am
not entirely sure of that.</p>
</section>
<section id="annotations-future-feature">
<h2><a class="toc-backref" href="#id16">Annotations Future Feature</a><a class="headerlink" href="#annotations-future-feature" title="Permalink to this headline"></a></h2>
<p>Found a 3.7 feature that is not covered by the test suite, the
<cite>__future__</cite> flag <cite>annotations</cite> wasn’t working as expected. In this,
strings are to be used for <cite>__annotations__</cite> where they show up (many
are ignored simply) and that requires an <cite>unparse</cite> function, going from
parsed ast (presumably it’s still syntax checked) back to the string,
but that was only very hard to get at, and with evil hackery.</p>
<p>For 3.8 a bug fix is promised that will give us the string immediately,
but for now my hack must suffice.</p>
</section>
<section id="msi-files">
<h2><a class="toc-backref" href="#id17">MSI files</a><a class="headerlink" href="#msi-files" title="Permalink to this headline"></a></h2>
<p>Following the 3.7.1 release, there are MSI files again, as the
regression of 3.7.0 to build them has been fixed in that release. The
MSI files will work with 3.7.0 also, just the building was broken.</p>
</section>
<section id="overall">
<h2><a class="toc-backref" href="#id18">Overall</a><a class="headerlink" href="#overall" title="Permalink to this headline"></a></h2>
<p>So 0.6.1 is in still in full swing in terms of optimization. I think I
need to make a release soon, simply because there is too much
unreleased, but useful stuff already.</p>
<p>I might have to postpone my goal of C int performance for one example
loop until next release. No harm in that. There already are plenty of
performance improvements across the board.</p>
</section>
<section id="twitter">
<h2><a class="toc-backref" href="#id19">Twitter</a><a class="headerlink" href="#twitter" title="Permalink to this headline"></a></h2>
<p>I continue to be very active there.</p>
<p><a class="reference external" href="https://twitter.com/kayhayen?ref_src=twsrc%5Etfw">Follow &#64;kayhayen</a></p>
<p>And lets not forget, having followers make me happy. So do re-tweets.</p>
<p>Adding Twitter more prominently to the web site is something that is
also going to happen.</p>
</section>
<section id="help-wanted">
<h2><a class="toc-backref" href="#id20">Help Wanted</a><a class="headerlink" href="#help-wanted" title="Permalink to this headline"></a></h2>
<p>If you are interested, I am tagging issues <a class="reference external" href="https://github.com/kayhayen/Nuitka/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22">help wanted</a>
and there is a bunch, and very likely at least one <em>you</em> can help with.</p>
<p>Nuitka definitely needs more people to work on it.</p>
</section>
<section id="donations">
<h2><a class="toc-backref" href="#id21">Donations</a><a class="headerlink" href="#donations" title="Permalink to this headline"></a></h2>
<p>If you want to help, but cannot spend the time, please consider to
donate to Nuitka, and go here:</p>
<p><a class="reference external" href="/pages/donations.html">Donate to Nuitka</a></p>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="nuitka-this-week-9.html">
       Nuitka this week #9
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="nuitka-this-week-11.html">
      Nuitka this week #11 
    </a>
    
  </span>
</div>
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Kay Hayen and Nuitka Contributors.</p>
  </div>

  
<div class='share-button-container'>
    <div class="socialbutton-wrapper">
        <a href="https://twitter.com/share?url=https://nuitka.net/posts/nuitka-this-week-10.html&hashtags=nuitka" target="_blank">
            <div class="socialbutton twitter" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-twitter.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="https://www.facebook.com/sharer.php?u=https://nuitka.net/posts/nuitka-this-week-10.html&hashtag=%23nuitka"  target="_blank">
            <div class="socialbutton facebook" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-facebook.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="http://www.reddit.com/submit?url=https://nuitka.net/posts/nuitka-this-week-10.html" target="_blank">
            <div class="socialbutton reddit">
                <p class="icon">
                    <img src="/_static/icon-reddit.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
      $('a[href^="http://"], a[href^="https://"]').not('a[class*=internal]').attr('target', '_blank');
    });
  </script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V73VK1T804"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-V73VK1T804', {
          'anonymize_ip': true,
      });
    </script> 

</body>
</html>