<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
    <link rel="icon" href="../_static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../_static/favicon.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../_static/favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="icon" href="../_static/apple-touch-icon-iphone.png" sizes="57x57" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad.png" sizes="72x72" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-iphone4.png" sizes="114x114" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad3.png" sizes="144x144" type="image/png">
    <link rel="apple-touch-icon" href="../_static/apple-touch-icon-180x180.png" sizes="180x180" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuitka this week #6</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" type="text/css" />
    <link rel="canonical" href="https://nuitka.net/posts/nuitka-this-week-6.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Nuitka Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nuitka the Python Compiler
            <img src="../_static/Nuitka-Logo-Symbol.svg" class="logo" alt="Logo"/>
          </a><!-- Empty override file take the place of searchbox.html, which generates search box. -->
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/user-manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commercial Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/commercial.html">Nuitka Commercial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html">Nuitka Release 0.6.20 (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-19">Nuitka Release 0.6.19</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-18">Nuitka Release 0.6.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#older-releases">Older Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/roadmap.html">Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/developer-manual.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/api-doc.html">API doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/factory.html">Factory Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/Presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/Streaming.html">Streaming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/impressum.html">Impressum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Under construction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/pyside2.html">Nuitka PySide2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/donations.html">Donations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/gsoc2019.html">Google Summer of Code 2019</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nuitka the Python Compiler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="nuitka-this-week-6">
<h1><a class="toc-backref" href="#id2">Nuitka this week #6</a><a class="headerlink" href="#nuitka-this-week-6" title="Permalink to this headline"></a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#nuitka-this-week-6" id="id2">Nuitka this week #6</a></p>
<ul>
<li><p><a class="reference internal" href="#holiday" id="id3">Holiday</a></p>
<ul>
<li><p><a class="reference internal" href="#bool" id="id4">bool</a></p></li>
<li><p><a class="reference internal" href="#void" id="id5">void</a></p></li>
<li><p><a class="reference internal" href="#module-var" id="id6">module_var</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#goto-generators" id="id7">Goto Generators</a></p></li>
<li><p><a class="reference internal" href="#benchmarks" id="id8">Benchmarks</a></p></li>
<li><p><a class="reference internal" href="#twitter" id="id9">Twitter</a></p></li>
<li><p><a class="reference internal" href="#poll-on-executable-names" id="id10">Poll on Executable Names</a></p></li>
<li><p><a class="reference internal" href="#hotfixes" id="id11">Hotfixes</a></p></li>
<li><p><a class="reference internal" href="#help-wanted" id="id12">Help Wanted</a></p></li>
<li><p><a class="reference internal" href="#plans" id="id13">Plans</a></p></li>
<li><p><a class="reference internal" href="#donations" id="id14">Donations</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="holiday">
<h2><a class="toc-backref" href="#id3">Holiday</a><a class="headerlink" href="#holiday" title="Permalink to this headline"></a></h2>
<p>In my 2 weeks holiday, I indeed focused on a really big thing, and got
more done that I had hoped for. For C types, <code class="docutils literal notranslate"><span class="pre">nuitka_bool</span></code>, which is a
tri-state boolean with true, false and unassigned, can be used for some
variables, and executes some operations without going through objects
anymore.</p>
<section id="bool">
<h3><a class="toc-backref" href="#id4">bool</a><a class="headerlink" href="#bool" title="Permalink to this headline"></a></h3>
<p>Condition codes are no longer special. They all need a boolean value
from the expression used as a condition, and there was a special paths
for some popular expressions for conditions, but of course not all. That
is now a universal thing, conditional statement/expressions will now
simply ask to provide a temp variable of value <code class="docutils literal notranslate"><span class="pre">nuitka_bool</span></code> and then
code generation handles it.</p>
<p>For where it is used, code gets a lot lighter, and of course faster,
although I didn’t measure it yet. Going to <code class="docutils literal notranslate"><span class="pre">Py_True</span></code>/<code class="docutils literal notranslate"><span class="pre">Py_False</span></code> and
comparing with it, wasn’t that optimal, and it’s nice this is now so
much cleaner as a side effect of that C bool work.</p>
<p>This seems to be so good, that actually it’s the default for this to be
used in 0.6.0, and that itself is a major break through. Not so much for
actual performance, but for structure. Other C types are going to follow
soon and will give massive performance gains.</p>
</section>
<section id="void">
<h3><a class="toc-backref" href="#id5">void</a><a class="headerlink" href="#void" title="Permalink to this headline"></a></h3>
<p>And what was really good, is that not only did I get <code class="docutils literal notranslate"><span class="pre">bool</span></code> to work
almost perfectly, I also started work on the <code class="docutils literal notranslate"><span class="pre">void</span></code> C target type and
finished that after my return from holiday last weekend, which lead to
new optimization that I am putting in the 0.5.33 release that is coming
soon, even before the <code class="docutils literal notranslate"><span class="pre">void</span></code> code generation is out.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">void</span></code> C type cannot read values back, and unused values should
not be used, so this gives errors for cases where that becomes obvious.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="ow">or</span> <span class="n">b</span>
</pre></div>
</div>
<p>Consider this expression. The <code class="docutils literal notranslate"><span class="pre">or</span></code> expression, that one is going to
producing a value, which is then released, but not used otherwise. New
optimzation creates a conditional statement out of it, which takes <code class="docutils literal notranslate"><span class="pre">a</span></code>
as the condition and if not true, then evaluates <code class="docutils literal notranslate"><span class="pre">b</span></code> but ignores it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">b</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">void</span></code> evaluation of <code class="docutils literal notranslate"><span class="pre">b</span></code> can then do further optimization for
it.</p>
<p>Void code generation can therefore highlight missed opportunities for
this kid of optimization, and found a couple of these. That is why I was
going for it, and I feel it pays off. Code generation checking
optimization here, is a really nice synergy between the two.</p>
<p>Plus I got all the tests to work with it, and solved the missing
optimizations it found very easily. And instead of allocating an object
now, not assigning is often creating more obvious code. And that too
allowed me to find a couple of bugs by C compiler warnings.</p>
<p>Obviously I will want to run a compile all the world test before making
it the default, which is why this will probably become part of 0.6.1 to
be the default.</p>
</section>
<section id="module-var">
<h3><a class="toc-backref" href="#id6">module_var</a><a class="headerlink" href="#module-var" title="Permalink to this headline"></a></h3>
<p>Previously variable codes were making a hard distinction for module
variables and make them use their own helper codes. Now this is
encapsulated in a normal C type class like <code class="docutils literal notranslate"><span class="pre">nuitka_bool</span></code>, or the one
for <code class="docutils literal notranslate"><span class="pre">PyObject</span> <span class="pre">*</span></code> variables, and integrates smoothly, and even got
better. A sign things are going smooth.</p>
</section>
</section>
<section id="goto-generators">
<h2><a class="toc-backref" href="#id7">Goto Generators</a><a class="headerlink" href="#goto-generators" title="Permalink to this headline"></a></h2>
<p>Still not released. I delayed it after my holiday, and due to the heap
generator change, after stabilizing the C types work, I want to first
finish a <code class="docutils literal notranslate"><span class="pre">tests/library/compile_python_module.py</span> <span class="pre">resume</span></code> run, which
will for a Anaconda3 compile all the code found in there.</p>
<p>Right now it’s still doing that, and even found a few bugs. The heap
storage can still cause issues, as can changes to cloning nodes, which
happens for <code class="docutils literal notranslate"><span class="pre">try</span></code> nodes and their <code class="docutils literal notranslate"><span class="pre">finally</span></code> blocks.</p>
<p>This should finish these days. I looked at performance numbers and found
that <code class="docutils literal notranslate"><span class="pre">develop</span></code> is indeed only faster, and <code class="docutils literal notranslate"><span class="pre">factory</span></code> due to even more
optimization will be yet faster, and often noteworthy.</p>
</section>
<section id="benchmarks">
<h2><a class="toc-backref" href="#id8">Benchmarks</a><a class="headerlink" href="#benchmarks" title="Permalink to this headline"></a></h2>
<p>The Speedcenter of Nuitka is what I use right now, but it’s only showing
the state of 3 branches and compared to CPython, not as much historical
information. Also the organization of tests is poor. At least there is
tags for what improved.</p>
<p>After release of Nuitka 0.6.0 I will show more numbers, and I will start
to focus on making it easier to understand. Therefore no link right now,
google if you are so keen. ;-)</p>
</section>
<section id="twitter">
<h2><a class="toc-backref" href="#id9">Twitter</a><a class="headerlink" href="#twitter" title="Permalink to this headline"></a></h2>
<p>During the holiday sprint, and even after, I am going to Tweet a lot
about what is going on for Nuitka. So follow me on twitter if you like,
I will post important stuff as it happens there:</p>
<p><a class="reference external" href="https://twitter.com/kayhayen?ref_src=twsrc%5Etfw">Follow &#64;kayhayen</a></p>
<p>And lets not forget, having followers make me happy. So do re-tweets.</p>
</section>
<section id="poll-on-executable-names">
<h2><a class="toc-backref" href="#id10">Poll on Executable Names</a><a class="headerlink" href="#poll-on-executable-names" title="Permalink to this headline"></a></h2>
<p>So I put e.g. poll up on Twitter, which is now over. But it made me
implement a new scheme, due to <a class="reference external" href="https://twitter.com/KayHayen/status/1037591355319640065">popular consensus</a></p>
</section>
<section id="hotfixes">
<h2><a class="toc-backref" href="#id11">Hotfixes</a><a class="headerlink" href="#hotfixes" title="Permalink to this headline"></a></h2>
<p>Even more hotfixes. I even did 2 during my holiday, however packages
built only later.</p>
<p>Threaded imports on 3.4 or higher of modules were not using the locking
they should use. Multiprocessing on Windows with Python3 had even more
problems, and the <code class="docutils literal notranslate"><span class="pre">--include-package</span></code> and <code class="docutils literal notranslate"><span class="pre">--include-module</span></code> were
present, but not working.</p>
<p>That last one was actually very strange. I had added a new option group
for them, but not added it to the parser. Result: Option works. Just
does not show up in help output. Really?</p>
</section>
<section id="help-wanted">
<h2><a class="toc-backref" href="#id12">Help Wanted</a><a class="headerlink" href="#help-wanted" title="Permalink to this headline"></a></h2>
<p>If you are interested, I am tagging issues <a class="reference external" href="https://github.com/kayhayen/Nuitka/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22">help wanted</a>
and there is a bunch, and very like one you can help with.</p>
<p>Nuitka definitely needs more people to work on it.</p>
</section>
<section id="plans">
<h2><a class="toc-backref" href="#id13">Plans</a><a class="headerlink" href="#plans" title="Permalink to this headline"></a></h2>
<p>Working down the release backlog. Things should be out. I am already
working on what should become 0.6.1, but it’s not yet 0.5.33 released.
Not a big deal, but 0.6.0 has 2 really important fixes for performance
regressions that have happened in the past. One is for loops, making
that faster is probably like the most important one. The other for
constant indexing, probably also very important. Very much measurable in
pystone at least.</p>
<p>In the mean time, I am preparing to get <code class="docutils literal notranslate"><span class="pre">int</span></code> working as a target C
type, so e.g. comparisons of such values could be done in pure C, or
relatively pure C.</p>
<p>Also, I noticed that e.g. in-place operations can be way more optimized
and did stuff for 0.6.1 already in this domain. That is unrelated to C
type work, but kind of follows a similar route maybe. How to compare
mixed types we know of, or one type only. That kind of things needs
ideas and experiments.</p>
<p>Having <code class="docutils literal notranslate"><span class="pre">int</span></code> supported should help getting some functions to C speeds,
or at least much closer to it. That will make noticeable effects in many
of the benchmarks. More C types will then follow one by one.</p>
</section>
<section id="donations">
<h2><a class="toc-backref" href="#id14">Donations</a><a class="headerlink" href="#donations" title="Permalink to this headline"></a></h2>
<p>If you want to help, but cannot spend the time, please consider to
donate to Nuitka, and go here:</p>
<p><a class="reference external" href="/pages/donations.html">Donate to Nuitka</a></p>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="nuitka-this-week-5.html">
       Nuitka this week #5
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     Next: 
    <a href="nuitka-release-0533.html">
      Nuitka Release 0.5.33 
    </a>
    
  </span>
</div>
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Kay Hayen and Nuitka Contributors.</p>
  </div>

  
<div class='share-button-container'>
    <div class="socialbutton-wrapper">
        <a href="https://twitter.com/share?url=https://nuitka.net/posts/nuitka-this-week-6.html&hashtags=nuitka" target="_blank">
            <div class="socialbutton twitter" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-twitter.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="https://www.facebook.com/sharer.php?u=https://nuitka.net/posts/nuitka-this-week-6.html&hashtag=%23nuitka"  target="_blank">
            <div class="socialbutton facebook" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-facebook.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="http://www.reddit.com/submit?url=https://nuitka.net/posts/nuitka-this-week-6.html" target="_blank">
            <div class="socialbutton reddit">
                <p class="icon">
                    <img src="/_static/icon-reddit.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>
    </div>
</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>