<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
    <link rel="icon" href="../_static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../_static/favicon.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../_static/favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="icon" href="../_static/apple-touch-icon-iphone.png" sizes="57x57" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad.png" sizes="72x72" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-iphone4.png" sizes="114x114" type="image/png">
    <link rel="icon" href="../_static/apple-touch-icon-ipad3.png" sizes="144x144" type="image/png">
    <link rel="apple-touch-icon" href="../_static/apple-touch-icon-180x180.png" sizes="180x180" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuitka Release 0.4.1</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-player_2.6.1.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" type="text/css" />
    <link rel="canonical" href="https://nuitka.net/posts/nuitka-release-041.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/tabs.js"></script>
        <script src="../_static/asciinema-player_2.6.1.js"></script>
        <script src="../_static/translations.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Nuitka Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nuitka the Python Compiler
            <img src="../_static/Nuitka-Logo-Symbol.png" class="logo" alt="Logo"/>
          </a><!-- Empty override file take the place of searchbox.html, which generates search box. -->
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/download.html">下载</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use.html">国际化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/support.html">支持</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">商务用户</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/commercial.html">Nuitka Commercial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">发行信息</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html">Nuitka Release 0.6.19 (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-18">Nuitka Release 0.6.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#nuitka-release-0-6-17">Nuitka Release 0.6.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/Changelog.html#older-releases">Older Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/roadmap.html">路线图</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/api-doc.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/factory.html">工厂说明书</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">媒体</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/Presentations.html">演讲稿</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/Streaming.html">流媒体</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/impressum.html">祈求</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">建设中</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/pyside2.html">Nuitka PySide2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/donations.html">Donations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/gsoc2019.html">Google Summer of Code 2019</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/nuitka-demo.html">Nuitka Demo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nuitka the Python Compiler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="nuitka-release-0-4-1">
<h1>Nuitka Release 0.4.1<a class="headerlink" href="#nuitka-release-0-4-1" title="永久链接至标题"></a></h1>
<p>This is to inform you about the new stable release of <a class="reference external" href="https://nuitka.net">Nuitka</a>. It is the extremely compatible Python compiler,
<a class="reference external" href="/doc/download.html">“download now”</a>.</p>
<p>This release is the first follow-up with a focus on optimization. The
major highlight is progress towards SSA form in the node tree.</p>
<p>Also a lot of cleanups have been performed, for both the tree building,
which is now considered mostly finished, and will be only reviewed. And
for the optimization part there have been large amounts of changes.</p>
<section id="new-features">
<h2>New Features<a class="headerlink" href="#new-features" title="永久链接至标题"></a></h2>
<ul>
<li><p>Python 3.3 experimental support</p>
<ul class="simple">
<li><p>Now compiles many basic tests. Ported the dictionary quick access
and update code to a more generic and useful interface.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">__qualname__</span></code> to classes and functions.</p></li>
<li><p>Small compatibility changes. Some exceptions changed, absolute
imports are now default, etc.</p></li>
<li><p>For comparison tests, the hash randomization is disabled.</p></li>
</ul>
</li>
<li><p>Python 3.2 support has been expanded.</p>
<p>The Python 3.2 on Ubuntu is not providing a helper function that was
used by Nuitka, replaced it with out own code.</p>
</li>
</ul>
</section>
<section id="bug-fixes">
<h2>Bug fixes<a class="headerlink" href="#bug-fixes" title="永久链接至标题"></a></h2>
<ul>
<li><p>Default values were not “is” identical.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">defaultKeepsIdentity</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s2">&quot;str_value&quot;</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">arg</span> <span class="ow">is</span> <span class="s2">&quot;str_value&quot;</span>


<span class="n">defaultKeepsIdentity</span><span class="p">()</span>
</pre></div>
</div>
<p>This now prints “True” as it does with CPython. The solution is
actually a general code optimization, see below.</p>
</li>
<li><p>Usage of <code class="docutils literal notranslate"><span class="pre">unicode</span></code> built-in with more than one argument could
corrupt the encoding argument string.</p>
<p>An implementation error of the <code class="docutils literal notranslate"><span class="pre">unicode</span></code> was releasing references
to arguments converted to default encoding, which could corrupt it.</p>
</li>
<li><p>Assigning Python3 function annotations could cause a segmentation
fault.</p></li>
</ul>
</section>
<section id="optimization">
<h2>Optimization<a class="headerlink" href="#optimization" title="永久链接至标题"></a></h2>
<ul>
<li><p>Improved propagation of exception raise statements, eliminating more
code. They are now also propagated from all kinds of expressions.
Previously this was more limited. An assertion added will make sure
that all raises are propagated. Also finally, raise expressions are
converted into raise statements, but without any normalization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now optimizing:</span>
<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
<span class="c1"># into (minus normalization):</span>
<span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="s2">&quot;integer division or modulo by zero&quot;</span>

<span class="c1"># Now optimizing:</span>
<span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">something</span>
<span class="c1"># into (minus normalization):</span>
<span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="s2">&quot;integer division or modulo by zero&quot;</span>

<span class="c1"># Now optimizing:</span>
<span class="n">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">something</span>
<span class="c1"># into (minus normalization), notice the side effects of first checking</span>
<span class="c1"># function and a as names to be defined, these may be removed only if</span>
<span class="c1"># they can be demonstrated to have no effect.</span>
<span class="n">function</span>
<span class="n">a</span>
<span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="s2">&quot;integer division or modulo by zero&quot;</span>
</pre></div>
</div>
<p>There is more examples, where the raise propagation is new, but you
get the idea.</p>
</li>
<li><p>Conditional expression nodes are now optimized according to the truth
value of the condition, and not only for compile time constants. This
covers e.g. container creations, and other things.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This was already optimized, as it&#39;s a compile time constant.</span>
<span class="n">a</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,)</span> <span class="k">else</span> <span class="n">b</span>
<span class="n">a</span> <span class="k">if</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">b</span>

<span class="c1"># These are now optimized, as their truth value is known.</span>
<span class="n">a</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">,)</span> <span class="k">else</span> <span class="n">b</span>
<span class="n">a</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">c</span><span class="p">,)</span> <span class="k">else</span> <span class="n">b</span>
</pre></div>
</div>
<p>This is simply taking advantage of infrastructure that now exists.
Each node kind can overload “getTruthValue” and benefit from it. Help
would be welcome to review which ones can be added.</p>
</li>
<li><p>Function creations only have side effects, when their defaults or
annotations (Python3) do. This allows to remove them entirely, should
they be found to be unused.</p></li>
<li><p>Code generation for constants now shares element values used in
tuples.</p>
<p>The general case is currently too complex to solve, but we now make
sure constant tuples (as e.g. used in the default value for the
compiled function), and string constants share the value. This should
reduce memory usage and speed up program start-up.</p>
</li>
</ul>
</section>
<section id="cleanups">
<h2>Cleanups<a class="headerlink" href="#cleanups" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>Optimization was initially designed around visitors that each did one
thing, and did it well. It turns out though, that this approach is
unnecessary, and constraint collection, allows for the most
consistent results. All remaining optimization has been merged into
constraint collection.</p></li>
<li><p>The names of modules containing node classes were harmonized to
always be plural. In the beginning, this was used to convey the
information that only a single node kind would be contained, but that
has long changed, and is unimportant information.</p></li>
<li><p>The class names of nodes were stripped from the “CPython” prefix.
Originally the intent was to express strict correlation to CPython,
but with increasing amounts of re-formulations, this was not used at
all, and it’s also not important enough to dominate the class name.</p></li>
<li><p>The re-formulations performed in tree building have moved out of the
“Building” module, into names “ReformulationClasses” e.g., so they
are easier to locate and review. Helpers for node building are now in
a separate module, and generally it’s much easier to find the content
of interest now.</p></li>
<li><p>Added new re-formulation of <code class="docutils literal notranslate"><span class="pre">print</span></code> statements. The conversion to
strings is now made explicit in the node tree.</p></li>
</ul>
</section>
<section id="new-tests">
<h2>New Tests<a class="headerlink" href="#new-tests" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>Added test to cover default value identity.</p></li>
</ul>
</section>
<section id="organisational">
<h2>Organisational<a class="headerlink" href="#organisational" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>The upload of <a class="reference external" href="http://pypi.python.org/pypi/Nuitka/">Nuitka to PyPI</a> has been repaired and now
properly displays project information again.</p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>The quicker release is mostly a consolidation effort, without much
actual performance progress. The progress towards SSA form matter a lot
on the outlook front. Once this is finished, standard compiler
algorithms can be added to Nuitka which go beyond the current peephole
optimization.</p>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     上一页:
    
    <a href="pystone-comparison-nuitka-cython-and-cpython.html">
       PyStone Comparison Nuitka, Cython, and CPython
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     下一页: 
    <a href="nuitka-rpms-rhel-centos-f17-f18-opensuse.html">
      Nuitka RPMs (RHEL, CentOS, F17, F18, openSUSE) 
    </a>
    
  </span>
</div>
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, Kay Hayen and Nuitka Contributors.</p>
  </div>

  
<div class='share-button-container'>
    <div class="socialbutton-wrapper">
        <a href="https://twitter.com/share?url=https://nuitka.net/posts/nuitka-release-041.html&hashtags=nuitka" target="_blank">
            <div class="socialbutton twitter" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-twitter.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="https://www.facebook.com/sharer.php?u=https://nuitka.net/posts/nuitka-release-041.html&hashtag=%23nuitka"  target="_blank">
            <div class="socialbutton facebook" data-share-url="https://nuitka.net">
                <p class="icon">
                    <img src="/_static/icon-facebook.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>

        <a href="http://www.reddit.com/submit?url=https://nuitka.net/posts/nuitka-release-041.html" target="_blank">
            <div class="socialbutton reddit">
                <p class="icon">
                    <img src="/_static/icon-reddit.png">
                </p>

                <p class="shares">share...</p>
            </div>
        </a>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
      $('a[href^="http://"], a[href^="https://"]').not('a[class*=internal]').attr('target', '_blank');
    });
  </script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V73VK1T804"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-V73VK1T804', {
          'anonymize_ip': true,
      });
    </script> 

</body>
</html>